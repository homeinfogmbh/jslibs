 <!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>lib.js unit test</title>
        <script src="lib.js"></script>
    </head>
    <body>
        <button type="button" onclick="test()" style="margin-left: 30%;">Run test</button>
        <br>
        <div id="log" style="margin-left: 30%;"></div>
        <script>
            var DOCTITLE = document.title;

            /*
                Returns the HTML logging element
            */
            function getLog() {
                return document.getElementById('log');
            }


            /*
                Logs message to HTML and browser console
            */
            function log(msg, prefix=null, suffix=null, errlvl=null) {
                var color = null;
                var text = null;
                var html = null;

                switch(errlvl) {
                    case true:
                        color = "green";
                        break;
                    case false:
                        color = "red";
                        break;
                }

                if (prefix === null) {
                    text = msg;

                    if (color === null) {
                        html = '<font face="monospace"><b>' + msg + '</b>';
                    } else {
                        html = '<font face="monospace" color="' + color + '"><b>' + msg + '</b>';
                    }
                } else {
                    text = prefix + '\t' + msg;

                    if (color === null) {
                        html = '<font face="monospace"><b>' + prefix + '</b>\t' + msg;
                    } else {
                        html = '<font face="monospace" color="' + color + '"><b>' + prefix + '</b></font>\t' + '<font face="monospace">' + msg;
                    }
                }

                html +=  '</font>';

                if (suffix !== null) {
                    text += " (" + suffix + ")";
                    html += ' <font face="monospace"><i>(' + suffix + ')</i></font>';
                }

                html += '<br>';

                console.log(text);
                getLog().innerHTML += html;
            }


            /*
                Evaluate a candidate's result against a target
            */
            function evaluate(candidate, result, target) {
                var testResult = (result === target);
                var suffix = null;

                if (testResult) {
                    prefix = "[passed]";
                } else {
                    prefix = "[failed]";
                    suffix = typeof(result) + " / " + typeof(target);
                }

                log(candidate + " → " + result, prefix, suffix, testResult);
                return testResult;
            }


            /*
                Test extensions and library functions defined here
            */
            function test() {
                // TODO: implement fully
                var result = true;

                // Clear log
                var logElement = getLog();
                logElement.innerHTML = "";

                // Test number prototype extensions
                log("### Testing Number.prototype extensions ###");
                log("* Number.isOdd()");

                var oddNumbers = [
                    [41, true],
                    [1337, true],
                    [-17, true],
                    [8008, false],
                    [-12134234, false],
                    [0, false],
                    [42.322, true],
                    [8008.13, true],
                    [8001.15, true],
                    [13127301.222, true]
                ];

                for (var i=0; i<oddNumbers.length; i++) {
                    var candidate = oddNumbers[i][0];
                    var target = oddNumbers[i][1];

                    if (! evaluate(candidate, candidate.isOdd(), target)) {
                        result = false;
                    }
                }

                // Test string prototype extensions
                log("### Testing String.prototype extensions ###");
                log("* String.capitalizeFirstLetter()");

                var capitalFirstLetters = [
                    ["foo", "Foo"],
                    ["Bar", "Bar"],
                    ["spAmM", "SpAmM"],
                    ["EGGS", "EGGS"]
                ];

                for (var i=0; i<capitalFirstLetters.length; i++) {
                    var candidate = capitalFirstLetters[i][0];
                    var target = capitalFirstLetters[i][1];

                    if (! evaluate(candidate, candidate.capitalizeFirstLetter(), target)) {
                        result = false;
                    }
                }

                log("* String.isEmail()");

                var emails = [
                    ["info@homeinfo.de", true],
                    ["homeinfo.de", false],
                    ["employee@homeinfo", false],
                    ["employee@sub.domain.homeinfo.com", true],
                    ["me@homeinfo", false]
                ];

                for (var i=0; i<emails.length; i++) {
                    var candidate = emails[i][0];
                    var target = emails[i][1];

                    if (! evaluate(candidate, candidate.isEmail(), target)) {
                        result = false;
                    }
                }

                log("* String.dot2comma()");

                var dot2comma = [
                    ["Hello, world!", "Hello, world!"],
                    ["I am so proud of you.", "I am so proud of you,"],
                    ["1,230,23.17", "1,230,23,17"],
                    ["12,50", "12,50"],
                    ["65.09", "65,09"]
                ];

                for (var i=0; i<dot2comma.length; i++) {
                    var candidate = dot2comma[i][0];
                    var target = dot2comma[i][1];

                    if (! evaluate(candidate, candidate.dot2comma(), target)) {
                        result = false;
                    }
                }

                log("* String.comma2dot()");

                var comma2dot = [
                    ["Hello, world!", "Hello. world!"],
                    ["I am so proud of you.", "I am so proud of you."],
                    ["1,230,23.17", "1.230,23.17"],
                    ["12,50", "12.50"],
                    ["65.09", "65.09"]
                ];

                for (var i=0; i<comma2dot.length; i++) {
                    var candidate = comma2dot[i][0];
                    var target = comma2dot[i][1];

                    if (! evaluate(candidate, candidate.comma2dot(), target)) {
                        result = false;
                    }
                }

                log("* String.padd0()");

                var padd0 = [
                    ["Hello, world!", "Hello, world!"],
                    ["1,230,23.17", "1,230,23.17"],
                    ["12,50", "12,50"],
                    ["12.50", "12.50"],
                    ["65.0", "65.0"],
                    ["65.", "65."],
                    ["65,0", "65,00"],
                    ["65,,0", "65,,0"]
                ];

                for (var i=0; i<padd0.length; i++) {
                    var candidate = padd0[i][0];
                    var target = padd0[i][1];

                    if (! evaluate(candidate, candidate.padd0(), target)) {
                        result = false;
                    }
                }

                log("* String.capitalize()");

                var capitalize = [
                    ["Hello, world!", "Hello, World!"],
                    ["My name is David Ruffin.", "My Name Is David Ruffin."],
                    ["12,50", "12,50"],
                    ["My Age IS 74.", "My Age Is 74."],
                    ["homeinfo", "Homeinfo"],
                    ["HOMEINFO.", "Homeinfo."]
                ];

                for (var i=0; i<capitalize.length; i++) {
                    var candidate = capitalize[i][0];
                    var target = capitalize[i][1];

                    if (! evaluate(candidate, candidate.capitalize(), target)) {
                        result = false;
                    }
                }

                log("* String.terminate()");

                var terminate = [
                    ["Hello, world!", ",", "Hello"],
                    ["My name is David Ruffin.", "D", "My name is "],
                    ["12,50", ",", "12"],
                    ["My age is 74.", " ", "My"],
                    ["homeinfo", "", ""],
                    ["HOMEINFO", "I", "HOME"]
                ];

                for (var i=0; i<terminate.length; i++) {
                    var candidate = terminate[i][0];
                    var char = terminate[i][1];
                    var target = terminate[i][2];

                    if (! evaluate(candidate + " ('" + char + "')", candidate.terminate(char), target)) {
                        result = false;
                    }
                }

                log("* String.umlauts()");

                var umlauts = [
                    ["Hello, world!", "Hello, world!"],
                    ["Die suesse Moehre goennt sich eine Aehre.", "Die süsse Möhre gönnt sich eine Ähre."],
                    ["ae oe ue Ae Oe Ue", "ä ö ü Ä Ö Ü"]
                ];

                for (var i=0; i<umlauts.length; i++) {
                    var candidate = umlauts[i][0];
                    var target = umlauts[i][1];

                    if (! evaluate(candidate, candidate.umlauts(), target)) {
                        result = false;
                    }
                }

                // Evaluate final result
                if (result) {
                    log('### Unit test passed ###', null, null, true);
                    document.title = DOCTITLE + " PASSED";
                } else {
                    log('XXX Unit test FAILED XXX', null, null, false);
                    document.title = DOCTITLE + " FAILED";
                }
            }
        </script>
    </body>
</html> 
